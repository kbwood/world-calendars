{"version":3,"file":"ParseFormat.js","names":["ATOM","COOKIE","FULL","ISO_8601","JULIAN","RFC_822","RFC_850","RFC_1036","RFC_1123","RFC_2822","RSS","W3C","formatDate","date","pattern","cal","calendar","local","dateFormat","index","doubled","match","step","matches","length","charAt","Math","floor","localiseNumbers","value","localiseDigits","formatNumber","len","num","formatName","shortNames","longNames","output","literal","day","dayOfWeek","dayNamesShort","dayNames","dayOfYear","weekOfYear","month","minMonth","monthNamesShort","monthNames","year","formatYear","epoch","CalendarBase","prototype","format","yearOrDate","monthOrPattern","y","m","d","CDate","validate","Calendars","invalidDate","errorMessages","missingNumberAt","unknownNameAt","unexpectedLiteralAt","unexpectedText","parseDate","iValue","iPattern","shortYear","getNumber","isDoubled","size","indexOf","localValue","substring","normaliseDigits","digits","RegExp","CalendarError","replace","parseInt","getName","offset","names","i","toLowerCase","checkLiteral","Number","NEGATIVE_INFINITY","doy","epochs","firstMonth","dim","daysInMonth","monthsInYear","parse"],"sources":["../src/ParseFormat.ts"],"sourcesContent":["/* http://keith-wood.name/calendars.html\r\n   Calendars parsing and formatting.\r\n   Written by Keith Wood (wood.keith{at}optusnet.com.au) June 2022.\r\n   Available under the MIT (http://keith-wood.name/licence.html) license.\r\n   Please attribute the author if you use it. */\r\n\r\nimport Calendars, { CalendarBase, CalendarError, CDate } from './Calendars'\r\n\r\n// Date form for ATOM (RFC 3339/ISO 8601).\r\nconst ATOM = 'yyyy-mm-dd'\r\n// Date form for cookies.\r\nconst COOKIE = 'D, dd M yyyy'\r\n// Date form for full date.\r\nconst FULL = 'DD, MM d, yyyy'\r\n// Date form for ISO 8601.\r\nconst ISO_8601 = 'yyyy-mm-dd'\r\n// Date form for Julian day number.\r\nconst JULIAN = 'J'\r\n// Date form for RFC 822.\r\nconst RFC_822 = 'D, d M yy'\r\n// Date form for RFC 850.\r\nconst RFC_850 = 'DD, dd-M-yy'\r\n// Date form for RFC 1036.\r\nconst RFC_1036 = 'D, d M yy'\r\n// Date form for RFC 1123.\r\nconst RFC_1123 = 'D, d M yyyy'\r\n// Date form for RFC 2822.\r\nconst RFC_2822 = 'D, d M yyyy'\r\n// Date form for RSS (RFC 822).\r\nconst RSS = 'D, d M yy'\r\n// Date form for W3c (ISO 8601).\r\nconst W3C = 'yyyy-mm-dd'\r\n\r\n/* Format a date object into a string value.\r\n   The format can be combinations of the following:\r\n    * d  - day of month (no leading zero)\r\n    * dd - day of month (two digit)\r\n    * o  - day of year (no leading zeros)\r\n    * oo - day of year (three digit)\r\n    * D  - day name short\r\n    * DD - day name long\r\n    * w  - week of year (no leading zero)\r\n    * ww - week of year (two digit)\r\n    * m  - month of year (no leading zero)\r\n    * mm - month of year (two digit)\r\n    * M  - month name short\r\n    * MM - month name long\r\n    * yy - year (two digit)\r\n    * yyyy - year (four digit)\r\n    * YYYY - formatted year\r\n    * e - epoch\r\n    * '...' - literal text\r\n    * '' - single quote */\r\nconst formatDate = function (date: CDate, pattern: string = ''): string {\r\n  const cal = date.calendar()\r\n  pattern = pattern || cal.local.dateFormat\r\n  let index = 0\r\n  // Check whether a format character is doubled\r\n  const doubled = (match: string, step?: number): boolean => {\r\n    let matches = 1\r\n    while (index + matches < pattern.length && pattern.charAt(index + matches) === match) {\r\n      matches++\r\n    }\r\n    index += matches - 1\r\n    return Math.floor(matches / (step || 1)) > 1\r\n  }\r\n  // Localise numbers if requested\r\n  const localiseNumbers = (value: string): string =>\r\n    cal.local.localiseDigits ? cal.local.localiseDigits(value) : value\r\n  // Format a number, with leading zeroes if necessary\r\n  const formatNumber = (match: string, value: number, len: number): string => {\r\n    let num = `${value}`\r\n    if (doubled(match)) {\r\n      while (num.length < len) {\r\n        num = `0${num}`\r\n      }\r\n    }\r\n    return num\r\n  }\r\n  // Format a name, short or long as requested\r\n  const formatName = (match: string, value: number, shortNames: string[], longNames: string[]): string =>\r\n    doubled(match) ? longNames[value] : shortNames[value]\r\n\r\n  let output = ''\r\n  let literal = false\r\n  for (index = 0; index < pattern.length; index++) {\r\n    if (literal) {\r\n      if (pattern.charAt(index) === \"'\" && !doubled(\"'\")) {\r\n        literal = false\r\n      } else {\r\n        output += pattern.charAt(index)\r\n      }\r\n    } else {\r\n      switch (pattern.charAt(index)) {\r\n        case 'd': output += localiseNumbers(formatNumber('d', date.day(), 2)); break\r\n        case 'D': output += formatName('D', date.dayOfWeek(), cal.local.dayNamesShort, cal.local.dayNames); break\r\n        case 'o': output += localiseNumbers(formatNumber('o', date.dayOfYear(), 3)); break\r\n        case 'w': output += localiseNumbers(formatNumber('w', date.weekOfYear(), 2)); break\r\n        case 'm': output += localiseNumbers(formatNumber('m', date.month(), 2)); break\r\n        case 'M': output += formatName('M', date.month() - cal.minMonth, cal.local.monthNamesShort, cal.local.monthNames); break\r\n        case 'y':\r\n          output += localiseNumbers(`${doubled('y', 2)\n              ? date.year()\r\n              : (date.year() % 100 < 10 ? '0' : '') + date.year() % 100}`)\r\n          break\r\n        case 'Y':\r\n          doubled('Y', 2)\r\n          output += date.formatYear()\r\n          break\r\n        case 'e': output += date.epoch(); break\r\n        case \"'\":\r\n          if (doubled(\"'\")) {\r\n            output += \"'\"\r\n          } else {\r\n            literal = true\r\n          }\r\n          break\r\n        default:\r\n          output += pattern.charAt(index)\r\n      }\r\n    }\r\n  }\r\n  return output\r\n}\r\n\r\nCalendarBase.prototype.format =\r\nfunction format (yearOrDate: CDate | number, monthOrPattern: string | number | undefined, day?: number, pattern?: string): string {\r\n  const [y, m, d] = yearOrDate instanceof CDate\r\n  // @ts-ignore: validate is protected\r\n    ? this.validate('', yearOrDate)\r\n  // @ts-ignore: validate is protected\r\n    : this.validate(Calendars.local.invalidDate, yearOrDate, monthOrPattern as number, day as number)\r\n  return yearOrDate instanceof CDate\r\n    ? formatDate(yearOrDate, monthOrPattern as string)\r\n    : formatDate(this.date(y, m, d), pattern)\r\n}\r\n\r\nconst errorMessages = {\r\n  missingNumberAt: 'Missing number at position {0}',\r\n  unknownNameAt: 'Unknown name at position {0}',\r\n  unexpectedLiteralAt: 'Unexpected literal at position {0}',\r\n  unexpectedText: 'Additional text found at end'\r\n}\r\n\r\n// Parse a string value into a date object.\r\nconst parseDate = function (cal: CalendarBase, value: string, pattern: string = ''): CDate {\r\n  pattern = pattern || cal.local.dateFormat\r\n  let iValue = 0 // Position in the value\r\n  let iPattern = 0 // Position in the pattern\r\n  let shortYear = false\r\n  // Check whether a format character is doubled\r\n  const doubled = (match: string, step?: number): boolean => {\r\n    let matches = 1\r\n    while (iPattern + matches < pattern.length && pattern.charAt(iPattern + matches) === match) {\r\n      matches++\r\n    }\r\n    iPattern += matches - 1\r\n    return Math.floor(matches / (step || 1)) > 1\r\n  }\r\n  // Extract a number from the string value\r\n  const getNumber = (match: string, step?: number): number => {\r\n    const isDoubled = doubled(match, step)\r\n    if (match === 'y') {\r\n      shortYear = !isDoubled\r\n    }\r\n    const size = [2, 3, isDoubled ? 4 : 2, isDoubled ? 4 : 2]['oyY'.indexOf(match) + 1]\r\n    // Normalise numbers if necessary\r\n    let localValue = value.substring(iValue)\r\n    localValue = cal.local.normaliseDigits ? cal.local.normaliseDigits(localValue) : localValue\r\n    const digits = new RegExp('^-?\\\\d{1,' + size + '}')\r\n    const num = localValue.match(digits)\r\n    if (!num) {\r\n      throw new CalendarError(errorMessages.missingNumberAt.replace(/\\{0\\}/, `${iValue}`))\r\n    }\r\n    iValue += cal.local.localiseDigits ? cal.local.localiseDigits(num[0]).length : num[0].length\r\n    return parseInt(num[0], 10)\r\n  }\r\n  // Extract a name from the string value and convert to an index\r\n  const getName = (match: string, shortNames: string[], longNames: string[], offset: number = 0): number => {\r\n    const names = (doubled(match) ? longNames : shortNames)\r\n    let index = -1\r\n    for (let i = 0; i < names.length; i++) {\r\n      if (value.substring(iValue, iValue + names[i].length).toLowerCase() === names[i].toLowerCase()) {\r\n        if (index === -1) {\r\n          index = i\r\n        } else if (names[i].length > names[index].length) {\r\n          index = i\r\n        }\r\n      }\r\n    }\r\n    if (index > -1) {\r\n      iValue += names[index].length\r\n      return index + offset\r\n    }\r\n    throw new CalendarError(errorMessages.unknownNameAt.replace(/\\{0\\}/, `${iValue}`))\r\n  }\r\n  // Confirm that a literal character matches the string value\r\n  const checkLiteral = (): void => {\r\n    if (value.charAt(iValue) !== pattern.charAt(iPattern)) {\r\n      throw new CalendarError(errorMessages.unexpectedLiteralAt.replace(/\\{0\\}/, `${iValue}`))\r\n    }\r\n    iValue++\r\n  }\r\n  let epoch = 1\r\n  let year = Number.NEGATIVE_INFINITY\r\n  let month = -1\r\n  let day = -1\r\n  let doy = -1\r\n  let literal = false\r\n  for (iPattern = 0; iPattern < pattern.length; iPattern++) {\r\n    if (literal) {\r\n      if (pattern.charAt(iPattern) === \"'\" && !doubled(\"'\")) {\r\n        literal = false\r\n      } else {\r\n        checkLiteral()\r\n      }\r\n    } else {\r\n      switch (pattern.charAt(iPattern)) {\r\n        case 'd': day = getNumber('d'); break\r\n        case 'D': getName('D', cal.local.dayNamesShort, cal.local.dayNames); break\r\n        case 'o': doy = getNumber('o'); break\r\n        case 'w': getNumber('w'); break\r\n        case 'm': month = getNumber('m'); break\r\n        case 'M': month = getName('M', cal.local.monthNamesShort, cal.local.monthNames, cal.minMonth); break\r\n        case 'y': year = getNumber('y', 2); break\r\n        case 'Y': year = getNumber('Y', 2); break\r\n        case 'e': epoch = getName('e', cal.local.epochs, cal.local.epochs); break\r\n        case '*': iValue = value.length; break\r\n        case \"'\":\r\n          if (doubled(\"'\")) {\r\n            checkLiteral()\r\n          } else {\r\n            literal = true\r\n          }\r\n          break\r\n        default: checkLiteral()\r\n      }\r\n    }\r\n  }\r\n  if (iValue < value.length) {\r\n    throw new CalendarError(errorMessages.unexpectedText)\r\n  }\r\n  if (year === Number.NEGATIVE_INFINITY) {\r\n    year = cal.date().year()\r\n  }\r\n  if (year < 100 && shortYear) {\r\n    year += Math.floor(cal.date().year() / 100) * 100\r\n  }\r\n  if (epoch === 0) {\r\n    year = -year\r\n  }\r\n  if (doy > -1) {\r\n    month = cal.firstMonth\r\n    day = doy\r\n    for (let dim = cal.daysInMonth(year, month); day > dim; dim = cal.daysInMonth(year, month)) {\r\n      month++\r\n      if (month > cal.monthsInYear(year)) {\r\n        month = cal.minMonth\r\n      }\r\n      day -= dim\r\n    }\r\n  }\r\n  return cal.date(year, month, day)\r\n}\r\n\r\nCalendarBase.prototype.parse = function (value: string, pattern: string = ''): CDate {\r\n  return parseDate(this, value, pattern)\r\n}\r\n\r\nexport { ATOM, COOKIE, FULL, ISO_8601, JULIAN, RFC_822, RFC_850, RFC_1036, RFC_1123, RFC_2822, RSS, W3C }\r\n"],"mappings":"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"}